<!DOCTYPE html>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title > ClasS, your class ! </title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="./style.css" type="text/css"/>
      
  
    </head>
    
   
    <body class="body-class">

        <div class="backgr">   
          
        <img  class="logohome" src="./img/logo.png" alt="Logo">   
        <nav class="homenav">  
         <a onclick="accounteCondition ()" href="registration.html" id="accounte">CREATE ACCOUNTE !    </a>  
         
         <a id="signin" onclick="signInStart ()" > SIGN IN !</a>  
         <a onclick= "choice ()" id="about"  >ABOUT </a> 
          <a href="mailto:alassane.traore@student.moringaschool.com"[] id = "contact" >CONTACT US !</a> 
         </nav>
      
    <!--<li id="index-title"><strong>ClasS!</strong><em>your class!</em></li>  -->
        
       
                  <div id="signInOptions">
                   <!-- <label for="Institution" id="instChoose"> Choose Institution</label> -->
                    <select name="" id="InstSel"   onchange="Instsell ()" >
                     <option value="tohidd" id="instChoose"  >Choose Institution </option>
                    </select>   <br>
                   <!-- <label  for="roll" id="roll">Sign In as :</label>  -->
                    <select   name="" id="rollSel" onchange="rollsell()" >
                           <option value="Choose"   >Sign In as </option> 
                           <option value="Student"  > Student</option>
                           <option value="Representative" >Representative</option>
                           <option value="chair" > chair</option>
                    </select>
                
                    <div id="SignInForm" >
                     <label for="name" style="color:gold ;"  > Name</label>
                     <input type="text" id="name"> <br>
                     <label for="key" style="color: gold;"> Key</label>
                     <input type="text" id="key">
                       <a id="sigInref1"  >ok</a>  
                      <a id="sigInref2"> ok </a> 
                       <a id="sigInref3"> ok </a>    

                     
                     
                    </div>
                  </div>

                  
                
            
       
        <!--<a href="" id="SignInok">okf </a> -->

        <script type="text/javaScript" src="./app.js"></script>
    
        <script>
//const accounteCreationButton = document.getElementById('submitAccounte');
        const signIn = document.getElementById('signin')
        const signInOptionsDiv = document.getElementById('signInOptions');
        const instSelect = document.getElementById('InstSel');
        const rollSel = document.getElementById('rollSel') 
         const signInForm = document.getElementById('SignInForm');
        // const name = document.getElementById('name');
        // const key = document.getElementById('key');
//const submitSign = document.getElementById('signInok');
const SignInRef1 = document.getElementById('sigInref1');
const signInRef2 = document.getElementById('sigInref2');
const SignInRef3 = document.getElementById('sigInref3');


 function signInStart (){
  signInOptionsDiv.style.visibility = 'visible';
}
function rollsell(){
  signInForm.style.visibility = 'visible';
  switch(rollSel.value){
      case 'Student':
      SignInRef1.style.visibility = 'visible';
      signInRef2.style.visibility = 'hidden';
      SignInRef3.style.visibility = 'hidden'
     let button1 = document.createElement('button')
     button1.id = 'button'
     signInForm.appendChild(button1);
     button1.append(SignInRef1)
     //button2.style.visibility = 'hidden';
     //button3.style.visibility = 'hidden';
      break;
      case 'Representative' :
      signInRef2.style.visibility = 'visible';
      SignInRef1.style.visibility = 'hidden';
      SignInRef3.style.visibility = 'hidden'
      let button2 = document.createElement('button')
     button2.id = 'button'
     signInForm.appendChild(button2);
     button2.append(signInRef2);
     //button1.style.visibility = 'hidden';
     //button3.style.visibility = 'hidden';
      break;
      case 'chair':
      SignInRef3.style.visibility = 'visible';
      SignInRef1.style.visibility = 'hidden';
      signInRef2.style.visibility = 'hidden'
      let button3 = document.createElement('button')
     button3.id = 'button'
     signInForm.appendChild(button3);
     button3.append(SignInRef3)
     //button2.style.visibility = 'hidden';
     //button1.style.visibility = 'hidden';
      break;
      default: alert ('something must be fixed!')
      break;
  }
  
}

function Instsell (){
rollSel.style.visibility = 'visible';
//alert('click!');
}




        </script>
      
      
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyBmc_KqjvSyDz9QLnveB4GasIYGwe2V-34",
              authDomain: "power-class.firebaseapp.com",
              databaseURL: "https://power-class-default-rtdb.firebaseio.com",
              projectId: "power-class",
              storageBucket: "power-class.appspot.com",
              messagingSenderId: "102798294958",
              appId: "1:102798294958:web:6db01ad48a8ca6fe5e523f",
              measurementId: "G-4RZHYSJDCM"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
        
            import{getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField , where, query,getDocs
        }
        from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js"
        
        
        // Initialize Cloud Firestore and get a reference to the service
        const db = getFirestore();
        
        const institutionName = document.getElementById('InstName');
        //const chair = document.getElementById('Name');
        const chairTitle = document.getElementById('title');
        const chairMail =  document.getElementById('Email');
        const chairPhone = document.getElementById("telephone");
        const institutionAddress= document.getElementById("Instaddress");
        const institutionMail = document.getElementById("Instemail");
        const studentsNames = document.getElementById("Stlist");
        const studentsKeys = document.getElementById("stkey");
        const studentsRepr = document.getElementById("inCharge"); 
        const studentsReprkeys = document.getElementById('inChargeK');
        const inscriptionDay  = document.getElementById("day");
        const accountePass = document.getElementById("Password");
        const accounteCreationButton = document.getElementById('submitAccounte');
        //const signIn = document.getElementById('signin')
        //const signInOptionsDiv = document.getElementById('signInOptions');
        //const instSelect = document.getElementById('InstSel');
        //const rollSel = document.getElementById('rollSel') 
         //const signInForm = document.getElementById('SignInForm');
         const name = document.getElementById('name');
         const key = document.getElementById('key');
//const submitSign = document.getElementById('signInok');
//const SignInRef1 = document.getElementById('sigInref1');
    
       

        const querySnapshot = await getDocs(collection(db, 'Institutions'));
        querySnapshot.forEach((doc)=> {
         //console.log(doc.id, "=>", doc.data());
          let eachInstitution = document.createElement('option');
          instSelect.appendChild(eachInstitution);
          eachInstitution.value = `${doc.data().institutionName}`
          eachInstitution.innerHTML = doc.data().institutionName
          //let forInt = eachInstitution.innerText;
 


    

        }); 
            
              
        SignInRef1.addEventListener('click',async function(e){
    //e.preventDefault();

    const q = query(collection(db, "Institutions"), where("institutionName", "==", `${instSelect.value}`));

const querySnapshot = await getDocs(q);
querySnapshot.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
  //console.log(doc.id, " => ", doc.data());
 
//console.log(rollSel.value)

//let student = document.getElementById ('student');
    let studentsstring = doc.data().students;
let studentsArray = studentsstring.split(',')
//console.log(studentsArray);

    if(studentsArray.includes(name.value) == false || studentsArray.includes(key.value) ==false){

    alert('Your User Name and/or Key are not correct !'); //SignInRef.href = "./yourCampus.html";
   // e.preventDefault();
}else{
    SignInRef1.href = './yourCampus.html';
    localStorage.setItem('Institution', instSelect.value);
    localStorage.setItem('Name', name.value);
    localStorage.setItem('Key', key.value);
    localStorage.setItem('roll', rollSel.value);
}
})
})

signInRef2.addEventListener('click', async function(e){
    //e.preventDefault();
    const q = query(collection(db, "Institutions"), where("institutionName", "==", `${instSelect.value}`));

const querySnapshot = await getDocs(q);
querySnapshot.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
 // console.log(doc.id, " => ", doc.data());
 
//console.log(rollSel.value)
let representativeString = doc.data().studentsRepresentatives;
let reprArray = representativeString.split(',');
//console.log(reprArray);

if(reprArray.includes(name.value) ==false || reprArray.includes(key.value)==false){
   
    alert('Your User Name and/or Key are not correct !')
    
} else{
    signInRef2.href = './yourCampus.html'

    localStorage.setItem('Institution', instSelect.value);
    localStorage.setItem('Name', name.value);
    localStorage.setItem('Key', key.value);
    localStorage.setItem('roll', rollSel.value);
}


})


} )

SignInRef3.addEventListener('click', async function(e){
   // e.preventDefault()

    const q = query(collection(db, "Institutions"), where("institutionName", "==", `${instSelect.value}`));

const querySnapshot = await getDocs(q);
querySnapshot.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
  //console.log(doc.id, " => ", doc.data())
  if(doc.data().chair !==String(name.value) 
|| doc.data().accountePass !== String(key.value)){
   // e.preventDefault();
    alert('Your User Name and/or Key are not correct !')
    
}else{
    SignInRef3.href = './yourCampus.html'
    localStorage.setItem('Institution', instSelect.value);
    localStorage.setItem('Name', name.value);
    localStorage.setItem('Key', key.value);
    localStorage.setItem('roll', rollSel.value);
} 

})
})
    

//document.getElementById('SignInok').href= './yourCampus.html'


 

       
    

        
</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


<style>

    
    #contact {
        color: aqua;
    }
    #btn {
        color: white;
        background-color: transparent;
        
        justify-content: center;
        display: flex;
        align-items: center;
        position: relative;
        
        height: 13vh;
        margin-top: 65%;
        margin-left: -91%;
        border-radius: 100px;
        border-bottom-color:green;
        border-left-color: green;
        border-top-color: green;
         border-right-color: gold;
         border-width: 9px;
        
        
    }
    
    </style>

</div>
</body>
               
  </html>
